# Check for secrets with gitleaks (optional - runs if installed)
if command -v gitleaks &> /dev/null; then
  echo "ğŸ” Running gitleaks..."
  gitleaks detect --verbose --no-git || {
    echo "âŒ Gitleaks detected secrets! Commit aborted."
    exit 1
  }
else
  echo "âš ï¸  Gitleaks not installed, skipping secrets scan..."
  echo "   Install from: https://github.com/gitleaks/gitleaks/releases"
fi

# Run Laravel Pint on backend files if any PHP files changed
if git diff --cached --name-only | grep -E '.*\.php$'; then
  echo "ğŸ¨ Running Laravel Pint..."
  cd servetrack-backend
  ./vendor/bin/pint
  cd ..
  echo "âœ… Pint formatted files, adding to commit..."
  git add servetrack-backend/
fi

echo "âœ… Pre-commit checks passed!"
