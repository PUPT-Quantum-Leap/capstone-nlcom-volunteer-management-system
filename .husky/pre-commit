#!/bin/sh
. "$(dirname -- "$0")/_/husky.sh"

# Check for secrets with gitleaks
echo "ğŸ” Running gitleaks..."
gitleaks detect --verbose --no-git || {
  echo "âŒ Gitleaks detected secrets! Commit aborted."
  exit 1
}

# Run Laravel Pint on backend files if any PHP files changed
if git diff --cached --name-only | grep -E '.*\.php$'; then
  echo "ğŸ¨ Running Laravel Pint..."
  cd servetrack-backend
  ./vendor/bin/pint
  cd ..
  echo "âœ… Pint formatted files, adding to commit..."
  git add servetrack-backend/
fi

echo "âœ… Pre-commit checks passed!"
